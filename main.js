(()=>{var g=()=>{};function T(s,t){let e=s.indexOf(t);if(e!=-1)return s.splice(e,1),!0}var D={};function S(s,...t){(D[s]||[]).map(e=>e(...t))}var d,_,b={get(s,t){return t=="_proxy"?!0:g}};function E(){return _}function A(s,{contextless:t=!1}={}){if(d=document.getElementById(s)||s||document.querySelector("canvas"),t&&(d=d||new Proxy({},b)),!d)throw Error("You must provide a canvas element for the game");return _=d.getContext("2d")||new Proxy({},b),_.imageSmoothingEnabled=!1,S("init"),{canvas:d,context:_}}function z(s,t){let e=Math.sin(t),i=Math.cos(t);return{x:s.x*i-s.y*e,y:s.x*e+s.y*i}}function C(s,t,e){return Math.min(Math.max(s,e),t)}var a=class{constructor(t=0,e=0,i={}){this.x=t,this.y=e,i._c&&(this.clamp(i._a,i._b,i._d,i._e),this.x=t,this.y=e)}add(t){return new a(this.x+t.x,this.y+t.y,this)}subtract(t){return new a(this.x-t.x,this.y-t.y,this)}scale(t){return new a(this.x*t,this.y*t)}normalize(t=this.length()){return new a(this.x/t,this.y/t)}dot(t){return this.x*t.x+this.y*t.y}length(){return Math.hypot(this.x,this.y)}distance(t){return Math.hypot(this.x-t.x,this.y-t.y)}angle(t){return Math.acos(this.dot(t)/(this.length()*t.length()))}clamp(t,e,i,n){this._c=!0,this._a=t,this._b=e,this._d=i,this._e=n}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?C(this._a,this._d,t):t}set y(t){this._y=this._c?C(this._b,this._e,t):t}};function v(){return new a(...arguments)}var k=class{constructor(t){return this.init(t)}init(t={}){this.position=v(),this.velocity=v(),this.acceleration=v(),this.ttl=1/0,Object.assign(this,t)}update(t){this.advance(t)}advance(t){let e=this.acceleration;t&&(e=e.scale(t)),this.velocity=this.velocity.add(e);let i=this.velocity;t&&(i=i.scale(t)),this.position=this.position.add(i),this._pc(),this.ttl--}get dx(){return this.velocity.x}get dy(){return this.velocity.y}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}isAlive(){return this.ttl>0}_pc(){}},P=class extends k{init({width:t=0,height:e=0,context:i=E(),render:n=this.draw,update:r=this.advance,children:h=[],anchor:o={x:0,y:0},opacity:c=1,rotation:w=0,scaleX:l=1,scaleY:f=1,...u}={}){this._c=[],super.init({width:t,height:e,context:i,anchor:o,opacity:c,rotation:w,scaleX:l,scaleY:f,...u}),this._di=!0,this._uw(),this.addChild(h),this._rf=n,this._uf=r}update(t){this._uf(t),this.children.map(e=>e.update&&e.update(t))}render(){let t=this.context;t.save(),(this.x||this.y)&&t.translate(this.x,this.y),this.rotation&&t.rotate(this.rotation),(this.scaleX!=1||this.scaleY!=1)&&t.scale(this.scaleX,this.scaleY);let e=-this.width*this.anchor.x,i=-this.height*this.anchor.y;(e||i)&&t.translate(e,i),this.context.globalAlpha=this.opacity,this._rf(),(e||i)&&t.translate(-e,-i),this.children.map(r=>r.render&&r.render()),t.restore()}draw(){}_pc(){this._uw(),this.children.map(t=>t._pc())}get x(){return this.position.x}get y(){return this.position.y}set x(t){this.position.x=t,this._pc()}set y(t){this.position.y=t,this._pc()}get width(){return this._w}set width(t){this._w=t,this._pc()}get height(){return this._h}set height(t){this._h=t,this._pc()}_uw(){if(!this._di)return;let{_wx:t=0,_wy:e=0,_wo:i=1,_wr:n=0,_wsx:r=1,_wsy:h=1}=this.parent||{};this._wx=this.x,this._wy=this.y,this._ww=this.width,this._wh=this.height,this._wo=i*this.opacity,this._wsx=r*this.scaleX,this._wsy=h*this.scaleY,this._wx=this._wx*r,this._wy=this._wy*h,this._ww=this.width*this._wsx,this._wh=this.height*this._wsy,this._wr=n+this.rotation;let{x:o,y:c}=z({x:this._wx,y:this._wy},n);this._wx=o,this._wy=c,this._wx+=t,this._wy+=e}get world(){return{x:this._wx,y:this._wy,width:this._ww,height:this._wh,opacity:this._wo,rotation:this._wr,scaleX:this._wsx,scaleY:this._wsy}}set children(t){this.removeChild(this._c),this.addChild(t)}get children(){return this._c}addChild(...t){t.flat().map(e=>{this.children.push(e),e.parent=this,e._pc=e._pc||g,e._pc()})}removeChild(...t){t.flat().map(e=>{T(this.children,e)&&(e.parent=null,e._pc())})}get opacity(){return this._opa}set opacity(t){this._opa=t,this._pc()}get rotation(){return this._rot}set rotation(t){this._rot=t,this._pc()}setScale(t,e=t){this.scaleX=t,this.scaleY=e}get scaleX(){return this._scx}set scaleX(t){this._scx=t,this._pc()}get scaleY(){return this._scy}set scaleY(t){this._scy=t,this._pc()}};var M=class extends P{init({image:t,width:e=t?t.width:void 0,height:i=t?t.height:void 0,...n}={}){super.init({image:t,width:e,height:i,...n})}get animations(){return this._a}set animations(t){let e,i;this._a={};for(e in t)this._a[e]=t[e].clone(),i=i||this._a[e];this.currentAnimation=i,this.width=this.width||i.width,this.height=this.height||i.height}playAnimation(t){this.currentAnimation=this.animations[t],this.currentAnimation.loop||this.currentAnimation.reset()}advance(t){super.advance(t),this.currentAnimation&&this.currentAnimation.update(t)}draw(){this.image&&this.context.drawImage(this.image,0,0,this.image.width,this.image.height),this.currentAnimation&&this.currentAnimation.render({x:0,y:0,width:this.width,height:this.height,context:this.context}),this.color&&(this.context.fillStyle=this.color,this.context.fillRect(0,0,this.width,this.height))}};function L(){return new M(...arguments)}function $(s){let t=s.canvas;s.clearRect(0,0,t.width,t.height)}function O({fps:s=60,clearCanvas:t=!0,update:e=g,render:i,context:n=E(),blur:r=!1}={}){if(!i)throw Error("You must provide a render() function");let h=0,o=1e3/s,c=1/s,w=t?$:g,l,f,u,m,p,y=!0;r||(window.addEventListener("focus",()=>{y=!0}),window.addEventListener("blur",()=>{y=!1}));function x(){if(f=requestAnimationFrame(x),!!y&&(u=performance.now(),m=u-l,l=u,!(m>1e3))){for(S("tick"),h+=m;h>=o;)p.update(c),h-=o;w(n),p.render()}}return p={update:e,render:i,isStopped:!0,start(){l=performance.now(),this.isStopped=!1,requestAnimationFrame(x)},stop(){this.isStopped=!0,cancelAnimationFrame(f)},_frame:x,set _last(R){l=R}},p}var{canvas:I,context:B}=A();function Y(){I.width=window.innerWidth,I.height=window.innerHeight}window.addEventListener("resize",Y);Y();var G=L({x:100,y:100,dx:2,width:20,height:40,color:"red"}),X=O({update(){G.update()},render(){G.render()}});X.start();})();
